/*
Update - Changed the case statement from TDL.REPOST_ETR_ID to VDL.TX_ID plus add tables - 20160901 MGM
*/

DECLARE @START_DATE AS DATE = EPIC_UTIL.EFN_DIN('06/30/2014')
DECLARE @END_DATE AS DATE = EPIC_UTIL.EFN_DIN('08/31/2014')

SELECT       COALESCE(TDL.DEPARTMENT_ID,000000000) AS COMPANY_CODE
            ,COALESCE(CAST(TDL.TX_ID AS VARCHAR(10)),'000000000') + '-' + COALESCE(CAST(TDL.ACCOUNT_ID AS VARCHAR(10)),'000000000') AS OLD_RCA_ACCOUNT_NUMBER
            ,COALESCE(CAST(VDL.TX_ID AS VARCHAR(10)),'000000000') + '-' + COALESCE(CAST(TDL.ACCOUNT_ID AS VARCHAR(10)),'000000000') AS NEW_RCA_ACCOUNT_NUMBER

FROM        ARPB_TRANSACTIONS               TDL
            INNER JOIN ARPB_TX_VOID                  VDL  ON TDL.TX_ID = VDL.OLD_ETR_ID

WHERE       tdl.void_date >= @start_date
			and tdl.void_date <= @end_date
			and tdl.service_area_id in (11,13,16,17,18,19)

ORDER BY COMPANY_CODE, OLD_RCA_ACCOUNT_NUMBER